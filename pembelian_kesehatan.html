<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surancy | Your Personal Insurance Partner</title>
    <link rel="stylesheet" href="./public/css/style.css">
    <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css">
</head>

<body>
    <header class="header">
        <div class="header-container">
            <a href="./index.html" class="logo">Surancy</a>
            <nav class="nav" id="navbar">
                <a href="./login.html" class="btn-outline" id="login-link">Login</a>
                <a href="./signup.html" class="btn-primary" id="signup-link">Sign Up</a>
            </nav>
        </div>
    </header>

    <main class="purchase-page container">
        <div class="purchase-card">
            <h1 class="logo-form" style="margin-bottom: 1rem;">
                <a href="./index.html">Surancy</a>
            </h1>
            <p class="subtitle">Formulir Pembelian Asuransi Kesehatan</p>

            <form id="InsuranceForm">
                <div class="form-group">
                    <label for="fullname">Nama lengkap</label>
                    <input type="text" id="fullname" placeholder="John Doe" required>
                </div>
                
                
                <div class="form-group">
                    <label for="Kelahiran">Tanggal lahir</label>
                    <input type="date" id="kelahiran" required />
                </div>
                
                <div class="form-group">
                    <label for="pekerjaan">Pekerjaan</label>
                    <input type="text" id="pekerjaan" placeholder="Contoh: Wiraswasta" required>
                </div>

                <div class="form-group">
                    <label for="rokok">Merokok?</label>
                    <select id="rokok" required>
                        <option value="0" selected="selected">Tidak Pernah</option>
                        <option value="1">Pernah</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="hipertensi">Pernah Hipertensi?</label>
                    <select id="hipertensi" required>
                        <option value="0" selected="selected">Tidak pernah</option>
                        <option value="1">Pernah</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="diabetes">Diabetes?</label>
                    <select id="diabetes" required>
                        <option value="0" selected="selected">Tidak</option>
                        <option value="1">Ya</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="premi">Harga Premi (Rp / tahun)</label>
                    <input
                    type="text"
                    id="premi"
                    readonly
                    style="background:#e6e6e6; color: #000000"
                    />
                </div>
                
                <button type="button" class="btn-action" onclick="hitungPremi()">Hitung Premi</button>
                <button type="submit" class="btn-action" onclick="checkout()">Checkout</button>
                <p id="errorMsg" class="error-msg"></p>
            </form>
        </div>
    </main>

    <footer class="footer">
        <div class="container footer-container">
            <div class="footer-left">
                <h2 class="logo">Surancy</h2>
                <p>Thank you for visiting Surancy. We are committed to providing the best experience for you.</p>
            </div>
            <nav class="footer-nav" id="footer-nav">
                <a href="./login.html" class="footer-link">Login</a>
                <a href="./signup.html" class="footer-link">Sign Up</a>
            </nav>
            <div class="footer-contact">
                <p><i class="bx bx-phone"></i> +62 812-3456-7890</p>
                <p><i class="bx bx-envelope"></i> support@surancy.com</p>
                <p><i class="bx bx-map"></i> Jakarta, Indonesia</p>
            </div>
        </div>
    </footer>

    <script src="./public/js/auth-check.js"></script>
    <script src="./public/js/navbar.js" defer></script>
    <script>
        let status = false;
        let fullname;
        let premiTahunan;
        
        function hitungPremi() {
            fullname = document.getElementById("fullname").value;
            let pekerjaan = document.getElementById("pekerjaan").value;
            let kelahiran = document.getElementById("kelahiran").value;
            let hipertensi = parseInt(document.getElementById("hipertensi").value);
            let rokok = parseInt(document.getElementById("rokok").value);
            let diabetes = parseInt(document.getElementById("diabetes").value);
            let premiInput = document.getElementById("premi");
            let errorMsg = document.getElementById("errorMsg");
            
                if (!fullname || !pekerjaan || !kelahiran) {
                    premiInput.value = "Lengkapi data input terlebih dahulu";
                    return;
                }

                const birthDate = new Date(kelahiran);
                const today = new Date();
                let age = today.getFullYear() - birthDate.getFullYear();
                const mDiff = today.getMonth() - birthDate.getMonth();

                if (mDiff < 0 || (mDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }

                let m = 0;
            
                if (age <= 20) {
                    m = 0.1;
                } else if (20 < age <= 35) {
                    m = 0.2;
                } else if (35 < age <= 50) {
                    m = 0.25;
                } else {
                    m = 0.4;
                }

                const p = 2000000;
                premiTahunan = p + (m * p) + (rokok * 0.5 * p) + (hipertensi * 0.4 * p) + (diabetes * (0.5 * p)); //saya ganti ke * yang di pdf aneh
                status = true;
                premiInput.value = "Rp " + premiTahunan.toLocaleString("id-ID");
            }

        function checkout(){
            function saveOrder(order) {
                let orders = JSON.parse(sessionStorage.getItem("orders")) || [];
                orders.push(order);
                sessionStorage.setItem("orders", JSON.stringify(orders));
            }

            document.getElementById("InsuranceForm").addEventListener("submit", function(e) {
                if(status){
                    e.preventDefault();
                    const order = { 'orderId': ("ORD-" + Date.now() + "-" + Math.floor(Math.random() * 1000)),'fullname': fullname, 'type': 'kesehatan', 'harga':premiTahunan};
                    saveOrder(order);
                    window.location.href = "./checkout.html"; 
                    return;
                }else{
                    e.preventDefault();
                    console.log("saya terpanggil haha")
                    errorMsg.textContent = "Lakukan perhitungan premi terlebih dahulu";
                    errorMsg.style.display = "block";               
                }
            });
        }
    </script>
</body>
</html>
