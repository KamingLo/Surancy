<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surancy | Your Personal Insurance Partner</title>
    <link rel="stylesheet" href="./public/css/style.css">
    <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css">
</head>

<body>
    <header class="header">
        <div class="header-container">
            <a href="./index.html" class="logo">Surancy</a>
            <nav class="nav" id="navbar">
                <a href="./login.html" class="btn-outline" id="login-link">Login</a>
                <a href="./signup.html" class="btn-primary" id="signup-link">Sign Up</a>
            </nav>
        </div>
    </header>

    <main class="purchase-page container">
        <div class="purchase-card">
            <h1 class="logo-form" style="margin-bottom: 1rem;">
                <a href="./index.html">Surancy</a>
            </h1>
            <p class="subtitle">Formulir Pembelian Asuransi Mobil</p>

            <form id="InsuranceForm">
            <div class="form-group">
                <label for="merk">Merk Mobil</label>
                <input type="text" id="merk" placeholder="Toyota, Honda, dll" required>
            </div>

            <div class="form-group">
                <label for="jenis">Jenis Mobil</label>
                <input type="text" id="jenis" placeholder="SUV, Sedan, MPV, dll" required>
            </div>

            <div class="form-group">
                <label for="tahun">Tahun Pembuatan</label>
                <input type="number" id="tahun" min="1980" max="2025" placeholder="2020" required>
            </div>

            <div class="form-group">
                <label for="harga">Harga Mobil (Rp)</label>
                <input type="number" id="harga" placeholder="contoh: 250000000" required>
            </div>

            <div class="form-group">
                <label for="plat">Nomor Plat Mobil</label>
                <input type="text" id="plat" placeholder="B 1234 XYZ" required>
            </div>

            <div class="form-group">
                <label for="mesin">Nomor Mesin</label>
                <input type="text" id="mesin" placeholder="Masukkan nomor mesin" required>
            </div>
            
            <div class="form-group">
                <label for="rangka">Nomor Rangka</label>
                <input type="text" id="rangka" placeholder="Masukkan nomor rangka" required>
            </div>

            <div class="form-group">
                <label for="pemilik">Nama Pemilik</label>
                <input type="text" id="pemilik" placeholder="Nama lengkap sesuai STNK" required>
            </div>

            <div class="form-group">
                <label>Foto Mobil</label>
                <input type="file" id="foto-depan" accept="image/*">
                <small>Foto Tampak Depan</small>
                <input type="file" id="foto-belakang" accept="image/*">
                <small>Foto Tampak Belakang</small>
                <input type="file" id="foto-kiri" accept="image/*">
                <small>Foto Samping Kiri</small>
                <input type="file" id="foto-kanan" accept="image/*">
                <small>Foto Samping Kanan</small>
                <input type="file" id="foto-dashboard" accept="image/*">
                <small>Foto Dashboard</small>
                <input type="file" id="foto-mesin" accept="image/*">
                <small>Foto Mesin</small>
            </div>

            <div class="form-group">
                <label for="premi">Harga Premi (Rp / tahun)</label>
                <input type="text" id="premi" readonly style="background:#e6e6e6; color: #000000;">
            </div>

                <button type="button" class="btn-action" onclick="hitungPremi()">Hitung Premi</button>
                <button type="submit" class="btn-action" onclick="checkout()">Checkout</button>
                <p id="errorMsg" class="error-msg"></p>
            </form>

        </div>
    </main>

    <footer class="footer">
        <div class="container footer-container">
            <div class="footer-left">
                <h2 class="logo">Surancy</h2>
                <p>Thank you for visiting Surancy. We are committed to providing the best experience for you.</p>
            </div>
            <nav class="footer-nav" id="footer-nav">
                <a href="./login.html" class="footer-link">Login</a>
                <a href="./signup.html" class="footer-link">Sign Up</a>
            </nav>
            <div class="footer-contact">
                <p><i class="bx bx-phone"></i> +62 812-3456-7890</p>
                <p><i class="bx bx-envelope"></i> support@surancy.com</p>
                <p><i class="bx bx-map"></i> Jakarta, Indonesia</p>
            </div>
        </div>
    </footer>

    <script src="./public/js/auth-check.js"></script>
    <script src="./public/js/navbar.js" defer></script>
    <script>
        const errorMsg = document.getElementById("errorMsg");
        let status = false;
        let fullname;
        let premi;

        function hitungPremi() {
                const merk = document.getElementById("merk");
                const plat = document.getElementById("plat");
                const mesin = document.getElementById("mesin");
                const jenis = document.getElementById("jenis");
                const rangka = document.getElementById("rangka");
                fullname = document.getElementById("pemilik").value;
                const tahun = parseInt(document.getElementById("tahun").value);
                const harga = parseInt(document.getElementById("harga").value);
                const premiInput = document.getElementById("premi");

                console.log(fullname);
                if (!merk || !jenis || !plat || !mesin || !rangka || !fullname || !tahun || !harga) {
                    premiInput.value = "Lengkapi data input terlebih dahulu";
                    return;
                }
            
                const umurMobil = new Date().getFullYear() - tahun;
                premi = 0;
            
                if (umurMobil <= 3) {
                    premi = 0.025 * harga;
                } else if (umurMobil > 3 && umurMobil <= 5) {
                    if (harga < 200000000) {
                        premi = 0.04 * harga;
                    } else {
                        premi = 0.03 * harga;
                    }
                } else {
                    premi = 0.05 * harga;
                }

                status = true;
                premiInput.value = "Rp." + premi.toLocaleString("id-ID");
            }

        function checkout(){
            function saveOrder(order) {
                let orders = JSON.parse(sessionStorage.getItem("orders")) || [];
                orders.push(order);
                sessionStorage.setItem("orders", JSON.stringify(orders));
            }

            document.getElementById("InsuranceForm").addEventListener("submit", function(e) {
                if(status){
                    e.preventDefault();
                    const order = { 'orderId': ("ORD-" + Date.now() + "-" + Math.floor(Math.random() * 1000)),'fullname': fullname, 'type': 'kesehatan', 'harga':premi};
                    saveOrder(order);
                    window.location.href = "./checkout.html"; 
                    return;
                }else{
                    e.preventDefault();
                    console.log("saya terpanggil haha")
                    errorMsg.textContent = "Lakukan perhitungan premi terlebih dahulu";
                    errorMsg.style.display = "block";               
                }
            });
        }
    </script>
</body>
</html>
